# 开启并配置索引 {#task_jqz_v55_cfb .task}

使用日志服务查询分析功能之前，请先开启并配置索引。

开启并配置索引后，您才可以查询配置索引后采集到的日志数据。请根据您的日志字段内容和查询需求，合理配置索引。

**说明：** 

-   开启查询和统计后意味着数据将会在后台被索引，会产生索引的流量，以及索引对应存储的空间。
-   开启和修改索引后，新的索引配置只对新写入的数据生效。
-   全文索引属性和字段索引属性必须至少启用一种。
-   打开对应字段的**统计**功能，才能使用SQL进行[统计分析](intl.zh-CN/用户指南/查询与分析/实时分析简介.md)。
-   如果配置公网IP、Unix时间戳等[Tag字段](../intl.zh-CN/产品简介/基本概念/日志.md#table_jvn_5fd_jbb)的索引，请配置**字段名称**为`__tag__:key`，例如`__tag__:__receive_time__`。同时，Tag字段不支持数值类型索引，请将所有Tag字段的索引**类型**配置为text（文本类型）。例如`__tag__:__receive_time__`字段，在查询时使用模糊查询`__tag__:__receive_time__: 1537928*`或全部匹配字段值`__tag__:__receive_time__: 1537928404`。

采集日志时日志服务会自动将日志来源、时间等信息以Key-Value对的形式添加到日志中，这些字段是日志服务的保留字段。当开启并配置索引时，自动开启这些字段的索引和统计功能。

**说明：** `__topic__`和`__source__`的索引分词为空，表示在查询这两个字段时，查询关键字必须完全匹配。

|保留字段名称|说明|
|:-----|:-|
|`__topic__`|日志主题（Topic）。如果您设置了[日志主题](intl.zh-CN/用户指南/Logtail采集/文本日志/生成主题.md)，日志服务会自动为您的日志添加日志主题字段，Key为`__topic__`，Value为您的主题内容。|
|`__source__`|日志来源。该字段表示这条日志的来源设备。|
|`__time__`|使用SDK写入日志数据时指定的日志时间。|

1.  登录[日志服务控制台](https://sls.console.aliyun.com)，单击Project名称。 
2.  在**查询分析**列，单击**查询**。 
3.  单击右上角的**开启索引**。 

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/21321/155479213812614_zh-CN.png)

    **说明：** 若您之前已创建过索引，可以单击**查询分析属性** \> **设置**，修改索引。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/21321/155479213814015_zh-CN.png)

4.  配置索引。 日志服务支持配置全文索引和字段索引，请至少配置一种。

    **说明：** 若同时配置了全文索引属性和字段索引属性，以字段索引属性设置为准。

    |索引类型|说明|
    |:---|:-|
    |全文索引|以文本形式对所有的字段进行建索引，Key和Value都是普通文本，都可查询。long类型字段在查询具体Value时需要指定对应的Key名称，其他类型字段在查询时不必指定Key的名称。|
    |字段索引|配置字段索引后，在查询时要指定Key的名称，当有某个字段配置了字段索引时，该字段上的全文索引不生效。字段可以配置为多种数据类型，包括：

    -   [文本类型（Text）](intl.zh-CN/用户指南/查询与分析/索引数据类型/文本类型.md)
    -   [JSON类型](intl.zh-CN/用户指南/查询与分析/索引数据类型/JSON类型.md)
    -   [数值类型（long和double）](intl.zh-CN/用户指南/查询与分析/索引数据类型/数值类型.md)
|

    1.  配置全文索引。 

        配置针对全文内容的索引，查询日志时默认查询所有Key对应的内容。

        |配置|说明|示例|
        |:-|:-|:-|
        |**全文索引**|对日志全文内容开启索引，默认的索引会查询日志中所有Key对应的内容，只要有一个命中，就会被查询到。|-|
        |**大小写敏感**|查询时是否区分大小写。其中：        -   **false** 表示不区分大小写，即查询关键字“INTERNALERROR”和“internalerror”都能查询到对应日志。
        -   **true**表示区分大小写，只能通过关键字“internalError”查询到对应日志。
|-|
        |**分词符**|根据指定单字符，将日志内容切分成多个关键词。例如一条日志内容为`a,b;c;D-F`。设置分隔符为逗号（,）、分号（;）和连字符（-），可以将日志内容切分为5个关键词”a” “b” “c” “D” “F”。|`, '";=()[]{}?@&<>/:\n\t`|

    2.  配置字段索引。 

        为特定的Key配置索引，配置字段索引后，可以通过查询特定Key的内容，缩小查询范围。

        **说明：** 

        -   日志服务自动为您创建[保留字段](#)`__topic__`、`__source__`和`__time__`的索引和统计功能。

        -   本文档以自定义页签为例。Nginx模板和消息服务模板仅用于采集Nginx日志和消息服务日志，不支持自定义配置索引。

        -   如果配置公网IP、Unix时间戳等[Tag字段](../intl.zh-CN/产品简介/基本概念/日志.md#table_jvn_5fd_jbb)的索引，请配置**字段名称**为`__tag__:key`，例如`__tag__:__receive_time__`。同时，Tag字段不支持数值类型索引，请将所有Tag字段的索引**类型**配置为text（文本类型）。例如`__tag__:__receive_time__`字段，在查询时使用模糊查询`__tag__:__receive_time__: 1537928*`或全部匹配字段值`__tag__:__receive_time__: 1537928404`。
        |配置|说明|示例|
        |:-|:-|:-|
        |**字段名称**|指定日志字段名称。|`_address_`|
        |**类型**|日志字段内容的数据类型，包括：        -   **text**：指定日志字段内容为文本类型。
        -   **long**：指定日志字段内容为整数，需要按照数值范围进行查询。
        -   **double**：指定日志字段内容为小数，需要按照数值范围进行查询。
        -   **json**：指定日志字段内容为json类型。
**说明：** 数值类型（long和double类型）不支持设置**大小写敏感**、**分词符**和**包含中文**。

|-|
        |**别名**|列的别名。别名仅用于SQL统计，在底层存储时，仍然是原始名称，搜索时仍需要使用原始名称。详细说明请参考[列的别名](intl.zh-CN/用户指南/查询与分析/SQL分析语法与功能/列的别名.md)。

|`address`|
        |**大小写敏感**|查询时，英文字母是否区分大小写。其中，        -    **false** ：不区分大小写，即查询关键字“INTERNALERROR”和“internalerror”都能查询到样例日志。
        -   **true**：区分大小写，只能通过关键字“internalError”查询到样例日志。
|-|
        |**分词符**|根据指定单字符，将日志内容切分成多个关键词。例如一条日志内容为`a,b;c;D-F`。设置分隔符为逗号“，”、分号“；”和连字符“-”，可以将日志内容切分为5个关键词”a” “b” “c” “D” “F”。

|`, '";=()[]{}?@&<>/:\n\t`|
        |**开启统计**|是否开启统计分析功能。该功能默认开启。开启之后，您可以结合查询语句和分析语句，对日志查询结果进行统计分析。

|-|

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/21321/155479213812713_zh-CN.png)

5.  单击**确定**，结束配置。 

    **说明：** 

    -   索引配置在1分钟之内生效。
    -   开启或修改索引后，新的索引配置只对新写入的数据生效。

